ktor:
    application:
        modules:
            - com.discovery.ApplicationKt.module
    deployment:
        port: 8080
        # Netty threading configuration
        connectionGroupSize: 14
        workerGroupSize: 100
        callGroupSize: 100
        shutdownGracePeriod: 2000
        shutdownTimeout: 3000

database:
    jdbcUrl: "jdbc:mysql://localhost:3306/ecommerce?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"
    username: "hoaidv"
    password: "pipipipi"
    # Tuned for high throughput
    # Increased pool size to handle high concurrency:
    # - Each request can use up to 4 concurrent DB connections (product, category, variants, media)
    # - With 5000 CCU, need sufficient connections to avoid acquisition timeouts
    # - R2DBC connections are lightweight and non-blocking, so larger pools are feasible
    maximumPoolSize: 500
    minimumIdle: 50
    connectionTimeout: 3000
    idleTimeout: 600000
    maxLifetime: 1800000

# ProductDetail LRU cache
cache:
    productDetail:
        enabled: true              # Enable/disable cache (for A/B testing)
        maxSize: 2000000           # Maximum number of entries (2M)
        warmup:
            enabled: true          # Enable cache warmup on startup
            productIdsFile: "experiment/product_ids.txt"  # Path to product IDs file

# Netty thread blocking monitor
monitor:
    blocking:
        enabled: false
        checkIntervalMs: 100       # How often to check thread states
        warningThresholdMs: 50     # Log warning if blocked > 50ms
        criticalThresholdMs: 200   # Log critical error if blocked > 200ms
        stackTraceOnWarning: true  # Include stack trace in warnings
